Hello, Cloud Gurus,
and welcome to this lecture.
And in this lecture,
we are going to create a content delivery network
using CloudFront.
We'll start off by creating an S3 bucket,
and I will be creating an S3 bucket
in a location that is as far away from me as possible
so that you can see the kind of latency
you can incur when you are trying to access an object in S3,
which is not geographically close to you.
So we'll add an image, and we'll access the image
from the S3 bucket.
Next, we'll create a CloudFront distribution,
and then we will access the image
using our CloudFront domain name,
and it will automatically send our request
to the closest edge location.
And we'll be able to compare the response time
between accessing our file using CloudFront
and accessing it directly from the S3 bucket.
So if you'd like to get started,
I'll see you in the AWS Console.
So here I am in the console,
and the first thing that we need to do
is create our CloudFront origin.
So head to Services,
and then under storage, select S3.
We'll create an S3 bucket,
and I'm going to create a bucket
that is furthest away from where I am right now.
So I'm located in London,
and I'm going to select a region
which is as far away as I can find,
so that's going to be Asia Pacific.
So I'm going to select Sydney.
And if you're working in your own AWS free tier account,
then you can create a bucket in any region
that is as far away from you as possible.
But if you're using our AWS Sandbox environment,
then you will need to create everything
in us-east-1 region
because you will not have permission to create resources
in any other region.
So just stick with us-east-1
if you are using our sandbox environment.
So I've picked Sydney,
and I'm going to give my bucket a name,
and I'll call it mysydneycforigin.
Scroll down, and we're going to configure this
as a public bucket,
so deselect the public access protection.
Scroll down, and acknowledge,
and then scroll down to the bottom, and Create Bucket.
It's telling me that a bucket with the same name
already exists,
so I'm just going to add some random numbers
onto the end of my bucket name,
and try again.
So there we go, that's our bucket created.
So go into your bucket, and we're going to upload a file.
So select Upload,
Add Files,
and I'm going to add an image file.
And I'm going to select a fairly large image
and it's 6.3 megabytes.
So select Open.
And the reason I want an image
is so that we can actually see it loading,
and we'll see it loading from the other side of the world.
Scroll down to permissions,
and we'll grant public access permissions
to this file as well.
Acknowledge
and Upload.
And you'll see, it takes quite a while to upload this image
because it's going all the way from London
to Sydney, Australia.
Okay, so that was successful.
I'm going to close that page.
And now if we select our object,
scroll down to the object URL,
I'm going to select that and open it in a new tab.
And you'll see that it takes quite a while to load.
It is not instant, like it would normally be
if I'd stored this image in a bucket located in the UK.
So there we go, it's just a picture of my little dog,
Ralphie, when he really was just a little puppy.
Now, if I'd selected London as my region for this S3 bucket,
then the image would appear pretty much instantaneously.
And imagine you're running a website
with lots of images on there.
Do you really want your customers seeing images
loading up as slowly as that?
Probably not.
So that is where CloudFront distributions come in.
So let's go ahead and set up our CloudFront distribution.
So come back to the console,
select Services,
scroll down to network &amp; content delivery,
and select CloudFront.
We'll Create a Distribution,
and it's going to be a web distribution.
And the first thing we'll need to do
is configure the name of our origin,
and this is where our files are stored,
the files that CloudFront will be serving.
And if we just click in this box,
we can see the S3 bucket that we created just a moment ago.
So select your S3 bucket. Under origin path,
this refers to different folders within your origin.
For example, if you had a different folder
within this bucket for images,
for videos, or HTML files,
then you can put the folder names under this origin path.
Scrolling down, restrict bucket access:
that's an option that you can use
if you wanted to restrict access
and enforce all users to come via CloudFront.
So there would be no direct access
directly into the S3 buckets.
Origin connection attempts
is the number of times that CloudFront
attempts to connect to the origin
with a default of 3 attempts.
And the connection timeout is the amount of time in seconds
that CloudFront will wait when trying to establish
a connection to the origin,
and the default is 10 seconds.
Then moving down to default cache behavior settings,
We've got various options here around HTTP and HTTPS,
so you've got the choice to allow both,
or you can redirect HTTP to HTTPS,
or HTTPS only.
And I'm going to select redirect,
so any request that comes in as HTTP
is going to get converted to HTTPS automatically.
And then under allowed methods,
this is pretty cool,
because it's not just about reading and accessing
and downloading files,
you can also PUT and POST.
So you can upload your files
using the CloudFront edge location,
and AWS will m417874anage the transfer of those files
from the edge location into your S3 bucket
or into your origin.
Moving down here, we have the cache policy,
and this is where we can define the time to live
or TTL of the files served by CloudFront,
and it's defined in this cache policy.
So let's take a look at the cache policy.
And TTL is the minimum amount of time in seconds
that you want your objects to stay in the CloudFront cache.
So, basically, how long is the object going to be cached for
before it expires and gets wiped from the cache?
And it's expressed in seconds.
So the maximum is 31 million seconds,
which equates to 365 days,
and the default is 86,000,
which equates to 24 hours.
Now, the thing to be aware of here
is that you might have some files
which get uploaded much more frequently than 24 hours.
For example, if you had files that were getting updated
on an hourly basis,
this time to live is not really going to work for you.
And you're going to find that your files
that are held in the edge locations
become out of date pretty quickly.
So in that case, the thing you want to do
is change this number here.
So you'll want to reduce it
and think about how frequently your data is changing.
So you want to set the time to live
to a fraction of the refresh frequency,
so maybe one-half, one-third,
one-quarter or less,
depending on how important it is for your material
to be up-to-date.
Heading back to the console,
we've also got this origin request policy.
And if we select the origin request policy,
this is where we can configure CloudFront
to forward HTTP request headers and cookies,
and CloudFront can actually serve different versions
of our objects based on the content of the request header
or cookie.
So if you select Create Origin Request Policy,
this is where you can set that up.
So you can configure CloudFront to include request headers
and cookies in the origin requests.
I'm just going to cancel that and come back to my setup
page. Scrolling down, this option here--
restrict viewer access and used signed URLs
or signed cookies--
this allows you to choose whether you want CloudFront
to require users to access your content
with a signed URL or a signed cookie.
And just imagine, you've got a website
and some of the content in your website is paid-for content.
Well, what you can do is restrict the access to that content
only to the users who have a signed URL.
And the users can't share that URL
because it's individual to them,
and you only release a signed URL to users
who have actually paid to view the content.
And that is actually technology that we've used here
at A Cloud Guru because we have some content on our site
which is for members only.
And we automatically generate this signed URL
to enable them to access the paid-for content.
Then, moving down,
we also have configuration for web application firewalls
or AWS WAF,
and this provides traffic filtering for well-known attacks,
things like SQL injection attacks
and cross site scripting attacks as well.
And the web application firewall is tightly integrated
with CloudFront.
Down here, you can also add your own domain name.
So if you own your own registered domain name
and you want to use that as the URL
for your CloudFront distribution,
you can add that in here.
And here we have SSL certificates.
Now, if you remember,
we selected the option at the beginning
to redirect all HTTP to HTTPS,
and that means we're going to need to use SSL certificates.
So we're just going to keep it to the default option
of using the default CloudFront certificate.
So now, we can just go ahead,
scroll down to the bottom and Create Distribution.
And it does just take a few minutes
for the distribution to be created.
And I think the reason for that is because CloudFront
is provisioning to lots of different edge locations
all around the world,
and it's replicating your distribution setup
to all of those edge locations.
So, as you can imagine,
that's a lot of locations to push the configuration to.
And it's just one of those things in AWS
that takes just a little bit longer.
So normally, it's about 5 minutes,
so I'd say, go and have a cup of tea or coffee,
and when you come back, it should almost be ready.
And after a few minutes,
it should show a status of deployed.
And mine took around 5 minutes.
So now, let's go ahead
and take a look at our CloudFront distribution.
And if you select the distribution ID,
this will just show the general parameters
that we've chosen for our distribution.
So we've got a distribution ID up here,
and then our domain name is displayed down here.
So let's have a look at some of the other tabs in this view.
Under restrictions,
this is where you can actually prevent users
in selected countries from accessing your content.
So you can create a whitelist and a block list as well.
So if we select Edit and Enable,
we can create an allow list
and add the countries that we want to allow.
And this is great if you are restricted from operating
in a particular country.
You can create an allow list
for all the countries that you want to allow
or a block list for any countries that you want to block.
But I'm going to Cancel that,
and then the next thing that I wanted to show you
is invalidations.
And invalidations is all about removing files
which are cached in the CloudFront edge location.
So for example, if the file has changed
or it's been updated,
but you've still got the old copy
cached in your CloudFront edge location,
and you don't want to wait for the time to live to expire
and automatically clear that old version,
if you want to remove that object
from the cache immediately,
then you will need to do an invalidation.
And this will invalidate the object
and effectively clear it from CloudFront.
So it's a manual process.
And just remember, every time you did it,
you will be charged a fee.
So now, let's just go back to our General settings,
and let's see if we can access our file using CloudFront.
So just copy your domain name,
I'm going to open a new browser tab
and paste my domain name in there.
Before we hit Enter,
we need to add our file name on the end.
So type / and the name of our file,
which is cute_dog.jpg,
and then hit Enter.
And there we go.
And it wasn't instant,
and that is because this is the first time
we're accessing the file using CloudFront.
But now, this file will be cached in my local edge location.
So let's try and access this file again,
and this time, I'm going to use a different browser,
so let's open up a different browser.
And this time, I'm going to use Safari.
So I'm just going to paste my URL into Safari.
And there we go,
the image displays pretty much instantaneously.
So onto my exam tips for CloudFront.
Just remember, CloudFront is a content delivery network
and it can be used to speed up the delivery
of your static content to viewer all around the world.
The origin is the location where your original content
is stored. For example, an S3 bucket.
And users can access your content
from a local edge location
instead of directly accessing the origin
which may not be geographically close to them.
So that is CloudFront.
And finally, if you are working
in your own AWS free tier account,
do remember to go in and delete everything
once you've finished,
otherwise, you will get charged.
And when it comes to your CloudFront distribution,
you will need to disable the distribution
before it will let you delete it.
So that's it for this lecture.
If you have any questions, please let me know,
otherwise, I will see you in the next lecture.
Thank you.